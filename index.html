<!DOCTYPE html>
<html>
<head>
	<title>junkai_qiu</title>
	<style>
		h1{
			font-family: sans-serif; 
			background-color: black; 
			color: white;
		}
		h2{
			font-family: sans-serif;
		}
		#countryList{
			list-style: none;
			padding: 10px;
			float:left;
		}
		.domain{
			fill: none;
			stroke: #000;
		}
		.tick{
			font-size: 12;
		}
		.tick line{
			stroke: #ccc;
		}
	</style>
</head>
<body>
	<h1> Gapiminder - Wealth and Health of Nations </h1>
	<div>
		<h2 >Countries</h2>
		<div id='countryList' />
	</div>
	<div id='svg'>
		<svg width="500" height="400">
			<g id='chart'/>
		</svg>
	</div>
</body>

<script src="https://d3js.org/d3.v3.min.js"></script>
<script>
	//parameters
	var year = 2008;
	var width = 500;
    var height = 400;
    var margin = { top: 20, left: 30, right: 20, bottom: 20};
    var innerWidth = width - margin.left - margin.right;
    var innerHeight = height - margin.top - margin.bottom;

    //global variables
    var chart = d3.select("#chart");
	var list = d3.select("#countryList");
	var xAxisGroup = chart.append("g")
		.attr("transform", "translate(" + 0 + "," + innerHeight + ")");
	var yAxisGroup = chart.append("g")
		.attr("transform", "translate(" + 0 + "," + 0 + ")");
	var dotGroup = chart.append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	
	function renderList(data){
		list.selectAll("li")
			.data(data)
			.enter()
			.append("li")
			.attr("class","listItem")
			.text(function(d){ return d.name})
	}

	function renderChart(data){
		chart.attr("width", width)
			.attr("height", height)
			.attr("transform", 
                 "translate(" + margin.left + "," + margin.top + ")");

		var xScale = d3.scale.linear()
            .range([0, innerWidth])
            .domain([-1000, d3.max(data, function(d,i) { return d.income[year]})]);

        var yScale = d3.scale.linear()
        .range([innerHeight, 0])
        .domain(d3.extent(data, function(d,i) { return d.lifeExpectancy[year]}));

        var rScale = d3.scale.linear()
        .range([20,1000])
        .domain(d3.extent(data, function(d,i) { return d.population[year]}));

        var colorScale = d3.scale.category10();

        var xAxis = d3.svg.axis()
        	.tickSize(-360)
        	.scale(xScale)
        	.orient("bottom");

        var yAxis = d3.svg.axis()
        	.tickSize(-450)
        	.scale(yScale)
        	.orient("left");

        xAxisGroup.call(xAxis);
        yAxisGroup.call(yAxis);

		chart.selectAll("circle")
			.data(data)
			.enter()
			.append("circle")
			.attr("r",
				function(d, i) {return Math.sqrt(rScale(d.population[year])/Math.PI) })
			.attr("cx",
				function(d, i) { return xScale(d.income[year]) })
			.attr("cy",
				function(d, i) { return yScale(d.lifeExpectancy[year]) })
			.attr("fill",
				function(d, i) { return colorScale(d.region) })
			.attr("opacity", 0.9);
	}


	function render(data){
		var filterData = data.filter(function(d){
			return d.income[year] && d.lifeExpectancy[year] && d.population[year];
		});

		renderList(filterData);
		renderChart(filterData);
		
	}

	d3.json("https://raw.githubusercontent.com/CristianFelix/infoviz/master/Week%203/newData.json", function(error, data){
		render(data);
	});

</script>
</html>